name: Make_Release
on: 
  workflow_dispatch:

jobs:
  build:
    name: Build os
    runs-on: ubuntu-20.04
    steps:
      - name: Build
        run: |
         sudo rm -rf /usr/local/lib/android
         sudo rm -rf /usr/share/dotnet
         sudo rm -rf /opt/ghc
         sudo rm -rf "/usr/local/share/boost"
         sudo rm -rf "$AGENT_TOOLSDIRECTORY"
         sudo apt-get update -y
         sudo apt-get dist-upgrade
         sudo apt-get install xorriso coreutils squashfs-tools git libssl1.1 -y
         wget "http://mirrors.kernel.org/ubuntu/pool/main/c/cd-boot-images-amd64/cd-boot-images-amd64_17_all.deb"
         sudo dpkg -i "cd-boot-images-amd64_17_all.deb"
         rm -rf "./cd-boot-images-amd64_17_all.deb"
         wget "http://mirrors.kernel.org/ubuntu/pool/universe/a/axel/axel_2.17.11-1_amd64.deb"
         sudo dpkg -i "axel_2.17.11-1_amd64.deb"
         rm -rf "./axel_2.17.11-1_amd64.deb"
         sudo git clone "https://github.com/cat-master21/RRR-builder.git" && cd ./RRR-builder
         source fetch_build.conf && axel "$DOWNLOAD_ISO" --output="ubuntu.iso"
         chmod +x ./build/build.sh ./build/switch.sh
         sudo df -h
         sudo make build.iso
         rm -rf ./ubuntu.iso
      - uses: "marvinpinto/action-automatic-releases@latest"
        with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: "continuous-generic"
          prerelease: false
          title: "Rolling Rhino generic release"
          files: rolling-rhino-$(date -I).iso
